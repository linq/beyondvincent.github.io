<div class="highlight"><pre><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesEnded:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="n">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span> <span class="p">{</span>
 
    <span class="c1">// 1 - Choose one of the touches to work with</span>
    <span class="n">UITouch</span> <span class="o">*</span> <span class="n">touch</span> <span class="o">=</span> <span class="p">[</span><span class="n">touches</span> <span class="n">anyObject</span><span class="p">];</span>
    <span class="n">CGPoint</span> <span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="n">touch</span> <span class="nl">locationInNode:</span><span class="n">self</span><span class="p">];</span>
 
    <span class="c1">// 2 - Set up initial location of projectile</span>
    <span class="n">SKSpriteNode</span> <span class="o">*</span> <span class="n">projectile</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKSpriteNode</span> <span class="nl">spriteNodeWithImageNamed:</span><span class="s">@&quot;projectile&quot;</span><span class="p">];</span>
    <span class="n">projectile</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
 
    <span class="c1">// 3- Determine offset of location to projectile</span>
    <span class="n">CGPoint</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">rwSub</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">projectile</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
 
    <span class="c1">// 4 - Bail out if you are shooting down or backwards</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
 
    <span class="c1">// 5 - OK to add now - we&#39;ve double checked position</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">projectile</span><span class="p">];</span>
 
    <span class="c1">// 6 - Get the direction of where to shoot</span>
    <span class="n">CGPoint</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">rwNormalize</span><span class="p">(</span><span class="n">offset</span><span class="p">);</span>
 
    <span class="c1">// 7 - Make it shoot far enough to be guaranteed off screen</span>
    <span class="n">CGPoint</span> <span class="n">shootAmount</span> <span class="o">=</span> <span class="n">rwMult</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
 
    <span class="c1">// 8 - Add the shoot amount to the current position       </span>
    <span class="n">CGPoint</span> <span class="n">realDest</span> <span class="o">=</span> <span class="n">rwAdd</span><span class="p">(</span><span class="n">shootAmount</span><span class="p">,</span> <span class="n">projectile</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
 
    <span class="c1">// 9 - Create the actions</span>
    <span class="kt">float</span> <span class="n">velocity</span> <span class="o">=</span> <span class="mf">480.0</span><span class="o">/</span><span class="mf">1.0</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">realMoveDuration</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">velocity</span><span class="p">;</span>
    <span class="n">SKAction</span> <span class="o">*</span> <span class="n">actionMove</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKAction</span> <span class="nl">moveTo:</span><span class="n">realDest</span> <span class="nl">duration:</span><span class="n">realMoveDuration</span><span class="p">];</span>
    <span class="n">SKAction</span> <span class="o">*</span> <span class="n">actionMoveDone</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKAction</span> <span class="n">removeFromParent</span><span class="p">];</span>
    <span class="p">[</span><span class="n">projectile</span> <span class="nl">runAction:</span><span class="p">[</span><span class="n">SKAction</span> <span class="nl">sequence:</span><span class="err">@</span><span class="p">[</span><span class="n">actionMove</span><span class="p">,</span> <span class="n">actionMoveDone</span><span class="p">]]];</span>
 
<span class="p">}</span>
</pre></div>